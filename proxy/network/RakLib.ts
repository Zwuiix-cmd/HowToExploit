import {RelaySession} from "../RelaySession";
import {Relay} from "bedrock-protocol";
import * as Path from "node:path";

export function createRakLib(host: string, port: number, destHost: string, destPort: number, motd: string, levelName: string) {
    const proxyOptions = {
        host: host,
        port: port,
        motd: { motd: motd, levelName: levelName },
        maxPlayers: 99999999,
        destination: { host: destHost, port: destPort },
        profilesFolder: Path.join(process.cwd(), "profiles"),
        enableChunkCaching: true,
        forceSingle: true,
        omitParseErrors: true,
    };

    const relay = new Relay(proxyOptions);
    relay.listen();

    relay.on('connect', player => {
        console.log('RelaySession opened');
        new RelaySession(player);
    });
}