import {Player, createClient, Client} from "bedrock-protocol";
import Path from "path";
import {BedrockPacket} from "../protocol/packet/Packet";
import {DataPacket} from "../protocol/packet/DataPacket";

export class BedrockClient {
    protected client!: Client;
    protected username: string;

    constructor(username: string) {
        this.username = username;
    }

    public connect(host: string, port: number = 19132)
    {
        this.client = createClient({
            host: host,
            port: port,
            username: " ",
            offline: false,
            skipPing: true,
            conLog: null,
            profilesFolder: Path.join(process.cwd(), "profiles"),
        })
    }

    public run(callback: Function = () => {}): void
    {
        this.client.on("packet", (packet: BedrockPacket) => {
            if(packet.name === "start_game") {
                callback();
            }
        });
    }

    public sendPacketToServer(packet: DataPacket)
    {
        this.client.queue(packet.name.toLowerCase(), packet.getProperties());
    }
}